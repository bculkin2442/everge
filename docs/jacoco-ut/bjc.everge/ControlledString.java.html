<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ControlledString.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">everge</a> &gt; <a href="index.source.html" class="el_package">bjc.everge</a> &gt; <span class="el_source">ControlledString.java</span></div><h1>ControlledString.java</h1><pre class="source lang-java linenums">package bjc.everge;

import java.util.Arrays;

/**
 * Represents a string with a set of control flags attached to it.
 *
 * @author Ben Culkin
 */
public class ControlledString {
	/**
	 * Represents a single control (a key-values pair)
	 *
	 * @author Ben Culkin
	 */
	public static class Control {
		/**
		 * The name of the control.
		 */
		public String name;

		/**
		 * The arguments to the control.
		 */
		public String[] args;

		/**
		 * Create a new blank control.
		 */
<span class="nc" id="L30">		public Control() {</span>

<span class="nc" id="L32">		}</span>

		/**
		 * Create a new argless control.
		 *
		 * @param nam
		 *            The name of the control.
		 */
<span class="fc" id="L40">		public Control(String nam) {</span>
<span class="fc" id="L41">			name = nam;</span>
<span class="fc" id="L42">		}</span>

		/**
		 * Create a new control.
		 *
		 * @param nam
		 *            The name of the control.
		 * @param ars
		 *            The arguments of the control.
		 */
<span class="fc" id="L52">		public Control(String nam, String... ars) {</span>
<span class="fc" id="L53">			name = nam;</span>
<span class="fc" id="L54">			args = ars;</span>
<span class="fc" id="L55">		}</span>

		/**
		 * Get the count of arguments this control has.
		 *
		 * @return The number of arguments to this control.
		 */
		public int count() {
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">			if (args == null) return 0;</span>
			
<span class="fc" id="L65">			return args.length;</span>
		}

		/**
		 * Get an argument from the control.
		 *
		 * @param i
		 *          The index of the argument to get.
		 * @return The argument at that position.
		 */
		public String get(int i) {
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">			if (i &lt; 0) {</span>
<span class="nc" id="L77">				String msg = String.format(</span>
<span class="nc" id="L78">						&quot;Control argument index must be greater than 0 (was %d)&quot;, i);</span>

<span class="nc" id="L80">				throw new IndexOutOfBoundsException(msg);</span>
			}

<span class="pc bpc" id="L83" title="1 of 2 branches missed.">			if (i &gt; args.length) {</span>
<span class="nc" id="L84">				String msg = String.format(</span>
						&quot;Control argument index must be less than %d (was %d)&quot;,
<span class="nc" id="L86">						args.length, i);</span>

<span class="nc" id="L88">				throw new IndexOutOfBoundsException(msg);</span>
			}

<span class="fc" id="L91">			return args[i];</span>
		}

		@Override
		public String toString() {
<span class="nc" id="L96">			StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L97">			sb.append(name);</span>

<span class="nc bnc" id="L99" title="All 4 branches missed.">			if (args != null &amp;&amp; args.length &gt; 0) {</span>
<span class="nc" id="L100">				sb.append(&quot;/&quot;);</span>

<span class="nc bnc" id="L102" title="All 2 branches missed.">				for (String arg : args) {</span>
<span class="nc" id="L103">					sb.append(arg);</span>
<span class="nc" id="L104">					sb.append(&quot;;&quot;);</span>
				}
			}

<span class="nc" id="L108">			return sb.toString();</span>
		}

		@Override
		public int hashCode() {
<span class="nc" id="L113">			final int prime = 31;</span>
<span class="nc" id="L114">			int result = 1;</span>
<span class="nc" id="L115">			result = prime * result + Arrays.hashCode(args);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">			result = prime * result + ((name == null) ? 0 : name.hashCode());</span>
<span class="nc" id="L117">			return result;</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">			if (this == obj) {</span>
<span class="nc" id="L123">				return true;</span>
			}
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">			if (obj == null) {</span>
<span class="nc" id="L126">				return false;</span>
			}
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">			if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L129">				return false;</span>
			}

<span class="fc" id="L132">			Control other = (Control) obj;</span>

<span class="pc bpc" id="L134" title="1 of 2 branches missed.">			if (name == null) {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">				if (other.name != null) {</span>
<span class="nc" id="L136">					return false;</span>
				}
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">			} else if (!name.equals(other.name)) {</span>
<span class="nc" id="L139">				return false;</span>
			}

<span class="pc bpc" id="L142" title="1 of 4 branches missed.">			boolean isArged = args != null &amp;&amp; args.length &gt; 0;</span>
<span class="pc bpc" id="L143" title="1 of 4 branches missed.">			boolean oIsArged = other.args != null &amp;&amp; other.args.length &gt; 0;</span>

<span class="pc bpc" id="L145" title="1 of 4 branches missed.">			if (isArged &amp;&amp; !oIsArged) {</span>
<span class="nc" id="L146">				return false;</span>
			}
<span class="pc bpc" id="L148" title="1 of 4 branches missed.">			if (!isArged &amp;&amp; oIsArged) {</span>
<span class="nc" id="L149">				return false;</span>
			}

<span class="pc bpc" id="L152" title="1 of 4 branches missed.">			if (isArged &amp;&amp; oIsArged) {</span>
<span class="fc" id="L153">				return Arrays.equals(args, other.args);</span>
			}

<span class="fc" id="L156">			return true;</span>
		}

		/**
		 * Convenient static constructor for static imports.
		 *
		 * @param nam
		 *            The name of the control.
		 * @param ars
		 *            The arguments to the control.
		 * @return A control with the right parameters.
		 */
		public static Control C(String nam, String... ars) {
<span class="fc" id="L169">			return new Control(nam, ars);</span>
		}
	}

	/**
	 * Parameter class for defining how to parse a ControlledString.
	 *
	 * @author Ben Culkin
	 */
	public static class ParseStrings {
		/**
		 * The indicator for separating controls from the regular string.
		 */
		public String contInd;

		/**
		 * The indicator for separating individual controls.
		 */
		public String contSep;

		/**
		 * The indicator for separating arguments to a control.
		 */
		public String contArg;

		/**
		 * The indicator for escaping any of the indicators (including itself)
		 */
		public String contEsc;

		/**
		 * Create a new set of parse strings.
		 *
		 * @param contInd
		 *                The control indicator.
		 * @param contSep
		 *                The control separator.
		 * @param contArg
		 *                The argument separator.
		 * @param contEsc
		 *                The control escape.
		 */
		public ParseStrings(String contInd, String contSep, String contArg,
<span class="fc" id="L212">				String contEsc) {</span>
<span class="fc" id="L213">			this.contInd = contInd;</span>
<span class="fc" id="L214">			this.contSep = contSep;</span>
<span class="fc" id="L215">			this.contArg = contArg;</span>
<span class="fc" id="L216">			this.contEsc = contEsc;</span>
<span class="fc" id="L217">		}</span>

		/**
		 * Convenient static constructor.
		 *
		 * @param contInd
		 *                The control indicator.
		 * @param contSep
		 *                The control separator.
		 * @param contArg
		 *                The argument separator.
		 * @param contEsc
		 *                The control escape.
		 * @return A new set of control strings.
		 */
		public static ParseStrings PS(String contInd, String contSep, String contArg,
				String contEsc) {
<span class="nc" id="L234">			return new ParseStrings(contInd, contSep, contArg, contEsc);</span>
		}
	}

	/**
	 * The string the controls apply to.
	 */
	public String strang;

	/**
	 * The controls that apply to the string.
	 */
	public Control[] controls;

	/**
	 * Create a new blank controlled string.
	 */
<span class="nc" id="L251">	public ControlledString() {</span>
<span class="nc" id="L252">		controls = new Control[0];</span>
<span class="nc" id="L253">	}</span>

	/**
	 * Create a new controlled string without any controls.
	 *
	 * @param strung
	 *               The string to use.
	 */
<span class="fc" id="L261">	public ControlledString(String strung) {</span>
<span class="fc" id="L262">		strang = strung;</span>

<span class="fc" id="L264">		controls = new Control[0];</span>
<span class="fc" id="L265">	}</span>

	/**
	 * Create a new controlled string.
	 *
	 * @param strung
	 *                 The string to use.
	 * @param controls
	 *                 The controls that apply to the string.
	 */
<span class="nc" id="L275">	public ControlledString(String strung, Control... controls) {</span>
<span class="nc" id="L276">		strang = strung;</span>

<span class="nc" id="L278">		this.controls = controls;</span>
<span class="nc" id="L279">	}</span>

	/**
	 * Check if the string has controls.
	 *
	 * @return Whether or not the string has controls.
	 */
	public boolean hasControls() {
<span class="fc bfc" id="L287" title="All 2 branches covered.">		return controls.length &gt; 0;</span>
	}

	/**
	 * Get the count of controls.
	 *
	 * @return The number of controls for this string.
	 */
	public int count() {
<span class="fc" id="L296">		return controls.length;</span>
	}

	/**
	 * Parse a controlled string from a regular string.
	 *
	 * The controls must be parsed from the beginning of the string.
	 *
	 * @param lne
	 *                The string to parse from.
	 * @param strangs
	 *                The object to read the strings from
	 * @return A parsed control string.
	 */
	public static ControlledString parse(String lne, ParseStrings strangs) {
<span class="fc bfc" id="L311" title="All 2 branches covered.">		if (!lne.startsWith(strangs.contInd)) {</span>
<span class="fc" id="L312">			return new ControlledString(lne);</span>
		}

<span class="fc" id="L315">		String[] bits = StringUtils.escapeSplit(strangs.contEsc, strangs.contInd, lne);</span>

<span class="pc bpc" id="L317" title="1 of 2 branches missed.">		if (bits.length &lt; 2) {</span>
<span class="nc" id="L318">			String msg = &quot;Did not find control terminator (%s) where it should be&quot;;</span>
<span class="nc" id="L319">			msg = String.format(msg, strangs.contInd);</span>

<span class="nc" id="L321">			throw new IllegalArgumentException(msg);</span>
		}

<span class="fc" id="L324">		ControlledString cs = new ControlledString(bits[0]);</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">		if (bits.length &gt; 2)</span>
<span class="fc" id="L326">			cs.strang = bits[2];</span>

<span class="fc" id="L328">		bits = StringUtils.escapeSplit(strangs.contEsc, strangs.contSep, bits[1]);</span>

<span class="fc" id="L330">		cs.controls = new Control[bits.length];</span>

<span class="fc bfc" id="L332" title="All 2 branches covered.">		for (int i = 0; i &lt; bits.length; i++) {</span>
<span class="fc" id="L333">			String bit = bits[i];</span>

<span class="fc" id="L335">			String[] bots</span>
<span class="fc" id="L336">					= StringUtils.escapeSplit(strangs.contEsc, strangs.contArg, bit);</span>

<span class="fc" id="L338">			Control cont = new Control(bots[0]);</span>

<span class="fc bfc" id="L340" title="All 2 branches covered.">			if (cont.name.length() &gt; 1) {</span>
<span class="fc" id="L341">				cont.name = cont.name.toUpperCase();</span>
			}

<span class="fc bfc" id="L344" title="All 2 branches covered.">			if (bots.length &gt; 1) {</span>
<span class="fc" id="L345">				cont.args = new String[bots.length - 1];</span>
<span class="fc bfc" id="L346" title="All 2 branches covered.">				for (int j = 1; j &lt; bots.length; j++) {</span>
<span class="fc" id="L347">					cont.args[j - 1] = bots[j];</span>
				}
			}

<span class="fc" id="L351">			cs.controls[i] = cont;</span>
		}

<span class="fc" id="L354">		return cs;</span>
	}

	@Override
	public String toString() {
<span class="nc" id="L359">		StringBuilder sb = new StringBuilder();</span>

<span class="nc" id="L361">		sb.append(&quot;//&quot;);</span>

<span class="nc bnc" id="L363" title="All 2 branches missed.">		for (Control cont : controls) {</span>
<span class="nc" id="L364">			sb.append(cont);</span>
		}

<span class="nc" id="L367">		sb.append(&quot;//&quot;);</span>
<span class="nc" id="L368">		sb.append(strang);</span>

<span class="nc" id="L370">		return sb.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>