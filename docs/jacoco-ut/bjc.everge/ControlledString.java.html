<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ControlledString.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">everge</a> &gt; <a href="index.source.html" class="el_package">bjc.everge</a> &gt; <span class="el_source">ControlledString.java</span></div><h1>ControlledString.java</h1><pre class="source lang-java linenums">package bjc.everge;

import java.util.Arrays;

/**
 * Represents a string with a set of control flags attached to it.
 *
 * @author Ben Culkin
 */
public class ControlledString {
	/**
	 * Represents a single control (a key-values pair)
	 *
	 * @author Ben Culkin
	 */
	public static class Control {
		/**
		 * The name of the control.
		 */
		public String name;

		/**
		 * The arguments to the control.
		 */
		public String[] args;

		/**
		 * Create a new blank control.
		 */
<span class="nc" id="L30">		public Control() {</span>

<span class="nc" id="L32">		}</span>

		/**
		 * Create a new argless control.
		 *
		 * @param nam
		 * 	The name of the control.
		 */
<span class="fc" id="L40">		public Control(String nam) {</span>
<span class="fc" id="L41">			name = nam;</span>
<span class="fc" id="L42">		}</span>

		/**
		 * Create a new control.
		 *
		 * @param nam
		 * 	The name of the control.
		 * @param ars
		 * 	The arguments of the control.
		 */
<span class="fc" id="L52">		public Control(String nam, String... ars) {</span>
<span class="fc" id="L53">			name = nam;</span>
<span class="fc" id="L54">			args = ars;</span>
<span class="fc" id="L55">		}</span>

		/**
		 * Get the count of arguments this control has.
		 *
		 * @return The number of arguments to this control.
		 */
		public int count() {
<span class="fc" id="L63">			return args.length;</span>
		}

		/**
		 * Get an argument from the control.
		 * 
		 * @param i The index of the argument to get.
		 * @return The argument at that position.
		 */
		public String get(int i) {
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">			if (i &lt; 0) {</span>
<span class="nc" id="L74">				String msg = String.format(&quot;Control argument index must be greater than 0 (was %d)&quot;, i);</span>

<span class="nc" id="L76">				throw new IllegalArgumentException(msg);</span>
			}

<span class="pc bpc" id="L79" title="1 of 2 branches missed.">			if (i &gt; args.length) {</span>
<span class="nc" id="L80">				String msg = String.format(&quot;Control argument index must be less than %d (was %d)&quot;,</span>
<span class="nc" id="L81">						args.length, i);</span>

<span class="nc" id="L83">				throw new IllegalArgumentException(msg);</span>
			}

<span class="fc" id="L86">			return args[i];</span>
		}

		@Override
		public String toString() {
<span class="nc" id="L91">			StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L92">			sb.append(name);</span>

<span class="nc bnc" id="L94" title="All 4 branches missed.">			if (args != null &amp;&amp; args.length &gt; 0) {</span>
<span class="nc" id="L95">				sb.append(&quot;/&quot;);</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">				for (String arg : args) {</span>
<span class="nc" id="L98">					sb.append(arg);</span>
<span class="nc" id="L99">					sb.append(&quot;;&quot;);</span>
				}
			}

<span class="nc" id="L103">			return sb.toString();</span>
		}

		@Override
		public int hashCode() {
<span class="nc" id="L108">			final int prime = 31;</span>
<span class="nc" id="L109">			int result = 1;</span>
<span class="nc" id="L110">			result = prime * result + Arrays.hashCode(args);</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			result = prime * result + ((name == null) ? 0 : name.hashCode());</span>
<span class="nc" id="L112">			return result;</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">			if (this == obj) { return true; }</span>
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">			if (obj == null) { return false; }</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">			if (getClass() != obj.getClass()) { return false; }</span>

<span class="fc" id="L121">			Control other = (Control) obj;</span>

<span class="pc bpc" id="L123" title="1 of 2 branches missed.">			if (name == null) {</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">				if (other.name != null) { return false; }</span>
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">			} else if (!name.equals(other.name)) { return false; }</span>

<span class="pc bpc" id="L127" title="1 of 4 branches missed.">			boolean isArged  = args != null &amp;&amp; args.length &gt; 0;</span>
<span class="pc bpc" id="L128" title="1 of 4 branches missed.">			boolean oIsArged = other.args != null &amp;&amp; other.args.length &gt; 0;</span>

<span class="pc bpc" id="L130" title="1 of 4 branches missed.">			if (isArged &amp;&amp; !oIsArged) { return false; }</span>
<span class="pc bpc" id="L131" title="1 of 4 branches missed.">			if (!isArged &amp;&amp; oIsArged) { return false; }</span>

<span class="pc bpc" id="L133" title="1 of 4 branches missed.">			if (isArged &amp;&amp; oIsArged) {</span>
<span class="fc" id="L134">				return Arrays.equals(args, other.args);</span>
			}

<span class="fc" id="L137">			return true;</span>
		}

		/**
		 * Convenient static constructor for static imports.
		 *
		 * @param nam
		 * 	The name of the control.
		 * @param ars
		 * 	The arguments to the control.
		 * @return A control with the right parameters.
		 */
		public static Control C(String nam, String... ars) {
<span class="fc" id="L150">			return new Control(nam, ars);</span>
		}
	}
	
	/**
	 * Parameter class for defining how to parse a ControlledString.
	 *
	 * @author Ben Culkin
	 */
	public static class ParseStrings {
		/**
		 * The indicator for separating controls from the regular string.
		 */
		public String contInd;

		/**
		 * The indicator for separating individual controls.
		 */
		public String contSep;

		/**
		 * The indicator for separating arguments to a control.
		 */
		public String contArg;

		/**
		 * The indicator for escaping any of the indicators (including itself)
		 */
		public String contEsc;

		/**
		 * Create a new set of parse strings.
		 *
		 * @param contInd
		 * 	The control indicator.
		 * @param contSep
		 * 	The control separator.
		 * @param contArg
		 * 	The argument separator.
		 * @param contEsc
		 * 	The control escape.
		 */
<span class="fc" id="L192">		public ParseStrings(String contInd, String contSep, String contArg, String contEsc) {</span>
<span class="fc" id="L193">			this.contInd = contInd;</span>
<span class="fc" id="L194">			this.contSep = contSep;</span>
<span class="fc" id="L195">			this.contArg = contArg;</span>
<span class="fc" id="L196">			this.contEsc = contEsc;</span>
<span class="fc" id="L197">		}</span>

		/**
		 * Convenient static constructor.
		 *
		 * @param contInd
		 * 	The control indicator.
		 * @param contSep
		 * 	The control separator.
		 * @param contArg
		 * 	The argument separator.
		 * @param contEsc
		 * 	The control escape.
		 * @return A new set of control strings.
		 */
		public static ParseStrings PS(String contInd, String contSep, String contArg, String contEsc) {
<span class="nc" id="L213">			return new ParseStrings(contInd, contSep, contArg, contEsc);</span>
		}
	}
	
	/**
	 * The string the controls apply to.
	 */
	public String strang;

	/**
	 * The controls that apply to the string.
	 */
	public Control[] controls;

	/**
	 * Create a new blank controlled string.
	 */
<span class="nc" id="L230">	public ControlledString() {</span>
<span class="nc" id="L231">		controls = new Control[0];</span>
<span class="nc" id="L232">	}</span>

	/**
	 * Create a new controlled string without any controls.
	 *
	 * @param strung
	 * 	The string to use.
	 */
<span class="fc" id="L240">	public ControlledString(String strung) {</span>
<span class="fc" id="L241">		strang = strung;</span>

<span class="fc" id="L243">		controls = new Control[0];</span>
<span class="fc" id="L244">	}</span>

	/**
	 * Create a new controlled string.
	 *
	 * @param strung
	 * 	The string to use.
	 * @param controls
	 * 	The controls that apply to the string.
	 */
<span class="nc" id="L254">	public ControlledString(String strung, Control... controls) {</span>
<span class="nc" id="L255">		strang = strung;</span>

<span class="nc" id="L257">		this.controls = controls;</span>
<span class="nc" id="L258">	}</span>

	/**
	 * Check if the string has controls.
	 *
	 * @return Whether or not the string has controls.
	 */
	public boolean hasControls() {
<span class="fc bfc" id="L266" title="All 2 branches covered.">		return controls.length &gt; 0;</span>
	}

	/**
	 * Get the count of controls.
	 *
	 * @return The number of controls for this string.
	 */
	public int count() {
<span class="fc" id="L275">		return controls.length;</span>
	}

	/**
	 * Parse a controlled string from a regular string.
	 *
	 * The controls must be parsed from the beginning of the string.
	 *
	 * @param lne
	 * 	The string to parse from.
	 * @param strangs
	 * 	The object to read the strings from
	 * @return A parsed control string.
	 */
	public static ControlledString parse(String lne, ParseStrings strangs) 
	{
<span class="fc bfc" id="L291" title="All 2 branches covered.">		if (!lne.startsWith(strangs.contInd)) {</span>
<span class="fc" id="L292">			return new ControlledString(lne);</span>
		}

<span class="fc" id="L295">		String[] bits = StringUtils.escapeSplit(strangs.contEsc, strangs.contInd, lne);</span>

<span class="pc bpc" id="L297" title="1 of 2 branches missed.">		if (bits.length &lt; 2) {</span>
<span class="nc" id="L298">			String msg = &quot;Did not find control terminator (%s) where it should be&quot;;</span>
<span class="nc" id="L299">			msg = String.format(msg, strangs.contInd);</span>

<span class="nc" id="L301">			throw new IllegalArgumentException(msg);</span>
		} 

<span class="fc" id="L304">		ControlledString cs = new ControlledString(bits[0]);</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">		if (bits.length &gt; 2) cs.strang = bits[2];</span>

<span class="fc" id="L307">		bits = StringUtils.escapeSplit(strangs.contEsc, strangs.contSep, bits[1]);</span>

<span class="fc" id="L309">		cs.controls = new Control[bits.length];</span>

<span class="fc bfc" id="L311" title="All 2 branches covered.">		for (int i = 0; i &lt; bits.length; i++) {</span>
<span class="fc" id="L312">			String bit = bits[i];</span>

<span class="fc" id="L314">			String[] bots = StringUtils.escapeSplit(strangs.contEsc, strangs.contArg, bit);</span>

<span class="fc" id="L316">			Control cont = new Control(bots[0]);</span>

<span class="fc bfc" id="L318" title="All 2 branches covered.">			if (cont.name.length() &gt; 1) {</span>
<span class="fc" id="L319">				cont.name = cont.name.toUpperCase();</span>
			}

<span class="fc bfc" id="L322" title="All 2 branches covered.">			if (bots.length &gt; 1) {</span>
<span class="fc" id="L323">				cont.args = new String[bots.length - 1];</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">				for (int j = 1; j &lt; bots.length; j++) {</span>
<span class="fc" id="L325">					cont.args[j - 1] = bots[j];</span>
				}
			}

<span class="fc" id="L329">			cs.controls[i] = cont;</span>
		}

<span class="fc" id="L332">		return cs;</span>
	}

	@Override
	public String toString() {
<span class="nc" id="L337">		StringBuilder sb = new StringBuilder();</span>

<span class="nc" id="L339">		sb.append(&quot;//&quot;);</span>

<span class="nc bnc" id="L341" title="All 2 branches missed.">		for (Control cont : controls) {</span>
<span class="nc" id="L342">			sb.append(cont);</span>
		}

<span class="nc" id="L345">		sb.append(&quot;//&quot;);</span>
<span class="nc" id="L346">		sb.append(strang);</span>

<span class="nc" id="L348">		return sb.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>